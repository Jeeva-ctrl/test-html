<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>JSON Accordion with Checkbox</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f9f9f9;
        }

        details summary {
            font-weight: bold;
            cursor: pointer;
            padding: 6px;
            border-radius: 5px;
            background-color: #e7f3ff;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            list-style: none;
            position: relative;
        }

        details summary::-webkit-details-marker {
            display: none;
        }

        .arrow {
            display: inline-block;
            width: 16px;
        }

        .property-container {
            display: flex;
            align-items: center;
            margin: 4px 0;
            margin-left: 20px;
        }

        .property-value {
            margin-left: 10px;
            color: #555;
            font-weight: normal;
            background: #f3f3f3;
            padding: 4px 8px;
            border-radius: 4px;
        }

        #output {
            white-space: pre-wrap;
            background: #eee;
            padding: 10px;
            margin-top: 20px;
            border-radius: 6px;
        }
    </style>
</head>

<body>
    <h2>JSON Accordion with Checkboxes</h2>
    <div id="accordion"></div>

    <h3>Selected JSON:</h3>
    <pre id="output"></pre>

    <script>
        const data = [
            {
                name: "Alice",
                age: 30,
                department: {
                    name: "Engineering",
                    manager: "John"
                },
                education: [
                    { degree: "B.Tech", university: "ABC University" },
                    { degree: "M.Tech", university: "XYZ Institute" }
                ]
            },
            {
                name: "Bob",
                age: 28,
                department: {
                    name: "Marketing",
                    manager: "Sara"
                },
                education: [
                    { degree: "BBA", university: "LMN College" }
                ]
            }
        ];

        const accordion = document.getElementById("accordion");
        let selectedJson = JSON.parse(JSON.stringify(data));

        function createAccordion(obj, parent, path = []) {
            if (Array.isArray(obj)) {
                obj.forEach((item, index) => {
                    const fullPath = [...path, index];
                    const details = document.createElement('details');

                    const summary = document.createElement('summary');
                    const arrow = document.createElement('span');
                    arrow.className = 'arrow';
                    arrow.textContent = '▶';
                    summary.appendChild(arrow);

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = true;
                    checkbox.dataset.path = JSON.stringify(fullPath);
                    checkbox.addEventListener('change', handleCheckboxChange);

                    summary.appendChild(checkbox);
                    summary.appendChild(document.createTextNode(` Item ${index}`));
                    details.appendChild(summary);
                    createAccordion(item, details, fullPath);
                    parent.appendChild(details);

                    details.addEventListener('toggle', () => {
                        arrow.textContent = details.open ? '▼' : '▶';
                    });
                });
                return;
            }

            for (let key in obj) {
                const value = obj[key];
                const fullPath = [...path, key];

                if (typeof value === 'object' && value !== null) {
                    const details = document.createElement('details');

                    const summary = document.createElement('summary');
                    const arrow = document.createElement('span');
                    arrow.className = 'arrow';
                    arrow.textContent = '▶';
                    summary.appendChild(arrow);

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = true;
                    checkbox.dataset.path = JSON.stringify(fullPath);
                    checkbox.addEventListener('change', handleCheckboxChange);

                    summary.appendChild(checkbox);
                    summary.appendChild(document.createTextNode(` ${key}`));
                    details.appendChild(summary);
                    createAccordion(value, details, fullPath);
                    parent.appendChild(details);

                    details.addEventListener('toggle', () => {
                        arrow.textContent = details.open ? '▼' : '▶';
                    });
                } else {
                    const container = document.createElement('div');
                    container.classList.add('property-container');

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = true;
                    checkbox.dataset.path = JSON.stringify(fullPath);
                    checkbox.addEventListener('change', handleCheckboxChange);

                    const label = document.createElement('label');
                    label.textContent = ` ${key}:`;

                    const valueText = document.createElement('span');
                    valueText.classList.add('property-value');
                    valueText.textContent = value;

                    container.appendChild(checkbox);
                    container.appendChild(label);
                    container.appendChild(valueText);
                    parent.appendChild(container);
                }
            }
        }

        function handleCheckboxChange(e) {
            const path = JSON.parse(e.target.dataset.path);
            const checked = e.target.checked;
            const container = e.target.closest("details") || e.target.closest("div");

            const childCheckboxes = container.querySelectorAll('input[type="checkbox"]');
            childCheckboxes.forEach(cb => {
                cb.checked = checked;
                if (cb !== e.target) {
                    const childPath = JSON.parse(cb.dataset.path);
                    updateSelectedJson(childPath, checked);
                }
            });

            updateSelectedJson(path, checked);
            displaySelectedJson();
        }

        function updateSelectedJson(path, checked) {
            const lastKey = path[path.length - 1];
            const parent = path.slice(0, -1).reduce((acc, key) => acc && acc[key], data);

            if (!parent) return;

            if (!checked) {
                if (Array.isArray(parent)) {
                    parent.splice(lastKey, 1);
                } else {
                    delete parent[lastKey];
                }
            } else {
                const original = path.reduce((acc, key) => acc && acc[key], data);
                let current = selectedJson;
                for (let i = 0; i < path.length - 1; i++) {
                    if (!current[path[i]]) {
                        current[path[i]] = typeof path[i + 1] === 'number' ? [] : {};
                    }
                    current = current[path[i]];
                }
                current[path[path.length - 1]] = original;
            }
        }

        function displaySelectedJson() {
            document.getElementById("output").textContent = JSON.stringify(selectedJson, null, 2);
        }

        createAccordion(data, accordion);
        displaySelectedJson();
    </script>
</body>

</html>
